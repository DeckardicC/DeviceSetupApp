# Диагностика — сценарии использования

**Важно:** Вкладка "Диагностика" доступна только на заданиях с услугой "гуйдлайн домофон".


A1. Данные о панели

Предусловия:
- Пользователь находится в задании
- Задание содержит услугу "гуйдлайн домофон"
- Пользователь перешел на 4‑ю вкладку задания
- Выбрал «Диагностика»

Основной сценарий:
1. Пользователь выбирает пункт «Данные о панели»
2. Система отображает сводную информацию о панели:
   - Сеть (IP, маска, шлюз, MAC)
   - Версии ПО (opt, media, rootfs)
   - SIP (статус регистрации и пояснение)
   - Непрерывная работа (количество дней)
   - Напряжение (текущее значение)
3. Пользователь нажимает кнопку «Доступ до камер»
4. Система открывает модальное окно с полем ввода номера телефона инженера связи
5. Система автоматически подтягивает номер телефона инженера связи на задании (для сценария)
6. Пользователь вводит номер телефона через клавиатуру и нажимает «Сохранить»
7. Система добавляет этот номер телефона в карточку квартиры 1100 в доме, в котором идет задание

Расширения:
5а. Номер телефона не был введен
- Система указывает на ошибку и просит ввести номер

Результат:
Пользователь видит актуальные параметры устройства в одном экране. Номер телефона инженера связи добавлен в карточку квартиры 1100.


A2. Домофон → Ключи

Предусловия:
- Пользователь находится во вкладке «Диагностика»
- Раздел «Домофон» открыт

Основной сценарий:
1. Пользователь выбирает «Ключи»
2. Система отображает список ключей с поиском и действиями
3. Пользователь нажимает кнопку «Добавить ключ»
4. Система открывает модальное окно с шагами:
   - Выбор подъезда
   - Выбор квартиры
   - NFC-считывание ключа
   - Ввод имени ключа
5. Пользователь последовательно проходит все шаги и нажимает «Сохранить»
6. Система проверяет, не привязан ли ключ к другому адресу:
   - Если ключ свободен → данные сохраняются, показывается уведомление "Ключ успешно добавлен"
   - Если ключ занят → показывается сообщение "Ключ уже привязан к другому адресу. Для повторного использования удалите его из текущей привязки."
7. Пользователь открывает ключ в списке, изменяет данные, сохраняет
8. Система обновляет ключ в списке
9. Пользователь удаляет ключ
10. Система убирает ключ из списка после подтверждения

Расширения:
2а. Пользователь вводит запрос в поле поиска
- Система фильтрует список по номеру ключа или квартире

А1. NFC недоступен/не сработал
- Система показывает сообщение: "Не удалось считать ключ. Убедитесь, что NFC включён и ключ приложен к телефону."
- Пользователь может нажать "Повторить считывание" для повторной попытки

А2. Имя ключа не введено
- Система показывает сообщение: "Введите имя ключа."

А3. Ключ уже привязан к другому адресу
- Система показывает сообщение: "Ключ уже привязан к другому адресу. Для повторного использования удалите его из текущей привязки."

А4. Пользователь нажимает кнопку с тремя точками (меню)
- Система показывает меню с опциями:
  - "Добавить файл CSV" - для импорта ключей из CSV файла
  - "Скачать файл CSV" - для экспорта ключей в CSV файл
  - "Управление ключами" - открывает модальное окно с настройкой "Проверка обратного идентификатора"

Результат:
Список ключей приведён к требуемому виду, поиск отобрал нужные элементы. Новые ключи добавлены через NFC-считывание с корректной валидацией.


A3. Домофон → Квартиры

Предусловия:
- Пользователь находится во вкладке «Диагностика»
- Раздел «Домофон» открыт

Основной сценарий:
1. Пользователь выбирает «Квартиры»
2. Система отображает список квартир с поиском и пагинацией
3. Пользователь просматривает список квартир
4. Пользователь открывает настройки квартиры через кнопку «Настройки» на карточке квартиры

Расширения:
2а. Пользователь вводит запрос в поиск
- Система показывает только подходящие квартиры

2б. В списке более 20 квартир
- Система отображает пагинацию; переключение страниц показывает соответствующие элементы

2в. Пользователь открывает меню «…» и выбирает «Общие уровни трубок»
- Система открывает форму общих значений; пользователь сохраняет — значения применены

2г. Пользователь выбирает «Сброс персональных настроек квартир»
- Система запрашивает подтверждение и сбрасывает индивидуальные настройки

**Примечание:** Функции добавления, редактирования и удаления квартир убраны. Доступен только просмотр списка и настройка квартир.

Результат:
Список квартир отображается корректно с возможностью поиска и пагинации. Общие параметры настроены в соответствии с действиями пользователя.


A4. Домофон → Настройки квартиры (6 вкладок)

Предусловия:
- Пользователь находится на экране «Квартиры»
- Карточки квартир отображены

Основной сценарий:
1. Пользователь нажимает «Настройки» на нужной квартире
2. Система открывает модальное окно с навигацией по вкладкам
3. Пользователь последовательно настраивает вкладки и сохраняет изменения

Расширения:
3а. «Основные» — пользователь меняет переключатели и настраивает "Тестовый вызов"
- Пользователь выбирает тип тестового вызова из выпадающего списка:
  * "Вызов в аналоговую трубку (без проверок)"
  * "Вызов в SIP (без проверок)"
  * "Вызов в аналоговую трубку и SIP"
- При нажатии на кнопку "Тестовый звонок" (если выбран тип вызова) начинается звонок
- Во время звонка кнопка меняется на ярко-зеленую "Завершить звонок"
- Пользователь нажимает "Завершить звонок" для завершения звонка
- Система сохраняет новые состояния

3б. «Аудио» — пользователь устанавливает значения ползунков
- Система фиксирует значения

3в. «Ключи» — пользователь добавляет/удаляет ключи квартиры
- Пользователь нажимает «Добавить ключ»
- Система сразу открывает экран для NFC-считывания ключа (без выбора подъезда и квартиры, так как уже в настройках конкретной квартиры)
- Пользователь прикладывает ключ к телефону для NFC-считывания
- После успешного считывания пользователь вводит имя ключа и нажимает «Сохранить»
- Система проверяет ключ на дубликаты и добавляет в список ключей квартиры
- Пользователь может удалять ключи из списка
- При ошибках NFC показываются соответствующие сообщения (см. A2, расширения А1-А3)

3г. «Коды» — пользователь добавляет/удаляет коды
- Пользователь нажимает кнопку «Добавить код»
- Система открывает поле ввода для нового кода
- Пользователь вводит код из 5 цифр и подтверждает
- Система проверяет код (5 цифр) и добавляет в список, если он уникален
- Пользователь может удалять отдельные коды
- Пользователь может удалить все коды кнопкой «Удалить все коды»

3д. «SIP‑номер» — пользователь добавляет/удаляет SIP-номера
- Пользователь видит список SIP-номеров
- Пользователь может вводить и добавлять дополнительные SIP-номера кнопкой «Добавить»
- Пользователь может удалять SIP-номера, но должен остаться хотя бы один
- Если остается только один SIP-номер, кнопка удаления для него скрывается
- Система сохраняет изменения

3е. «Диагностика» — пользователь вводит напряжения и сохраняет
- Блок "Диагностика" отображается первым (выше блока "Уровни напряжения")
- Пользователь вводит напряжения и сохраняет
- Система применяет параметры

Результат:
Индивидуальные настройки выбранной квартиры сохранены по всем вкладкам. Тестовый вызов работает с выпадающим списком типов. Коды и SIP-номера корректно добавлены/удалены.


A5. Домофон → Матрица (КМК)

Предусловия:
- Пользователь находится во вкладке «Диагностика»
- Раздел «Домофон» открыт

Основной сценарий:
1. Пользователь выбирает «Матрица»
2. Система отображает выбор коммутатора и таблицу матрицы
3. Пользователь включает режим редактирования, нажимает на ячейку для редактирования
4. Система открывает модальное окно редактирования ячейки
5. Пользователь может изменять значение:
   - С помощью кнопок "+" и "-" для увеличения/уменьшения значения
   - С помощью клавиатуры для прямого ввода
6. Пользователь сохраняет изменения
7. Система применяет новую конфигурацию
8. Пользователь может использовать "Мастер автозаполнения"
9. Система открывает модальное окно мастера
10. Пользователь заполняет поля:
    - Производитель (выбор из списка)
    - Модель (выбор из списка, зависит от производителя)
    - Количество квартир (числовое поле с кнопками +/-)
    - Номер 1-ой квартиры в матрице (числовое поле с кнопками +/-)
11. Пользователь нажимает "Запустить"
12. Система выполняет автозаполнение матрицы согласно введенным параметрам

Расширения:
4а. Пользователь нажимает «Отмена»
- Система возвращает исходное состояние матрицы

5а. Пользователь не заполнил все обязательные поля в мастере автозаполнения
- Система показывает ошибку и просит заполнить все поля

Результат:
Матрица соединений изменена или оставлена без изменений по выбору пользователя. Мастер автозаполнения помог быстро настроить матрицу.


A6. Домофон → Вход

Предусловия:
- Пользователь находится во вкладке «Диагностика»
- Раздел «Домофон» открыт

Основной сценарий:
1. Пользователь выбирает «Вход»
2. Система показывает доступные режимы
3. Пользователь меняет нужные режимы
4. Система сохраняет новые состояния

Результат:
Режимы входа установлены согласно действиям пользователя.


A7. Домофон → Бегущая строка

Предусловия:
- Пользователь находится во вкладке «Диагностика»
- Раздел «Домофон» открыт

Основной сценарий:
1. Пользователь выбирает «Бегущая строка»
2. Система отображает статус и поле ввода текста
3. При фокусе на поле ввода текста клавиатура автоматически открывается
4. Пользователь редактирует текст (максимум 99 символов)
5. Система показывает счетчик оставшихся символов: "Осталось символов для ввода: X"
6. Пользователь настраивает скорость бегущей строки
7. Пользователь сохраняет изменения
8. Система применяет изменения

Расширения:
3а. Пользователь пытается ввести более 99 символов
- Система ограничивает ввод до 99 символов

Результат:
Текст и статус бегущей строки обновлены. Текст ограничен 99 символами, счетчик отображает оставшееся количество.


A8. Аудио → Звук

Предусловия:
- Пользователь находится во вкладке «Диагностика»
- Раздел «Аудио» открыт

Основной сценарий:
1. Пользователь выбирает «Звук»
2. Система показывает набор ползунков
3. Пользователь устанавливает значения
4. Система сохраняет изменения

Результат:
Параметры звука установлены.


A9. Аудио → Эквалайзер

Предусловия:
- Пользователь находится во вкладке «Диагностика»
- Раздел «Аудио» открыт

Основной сценарий:
1. Пользователь выбирает «Эквалайзер»
2. Система показывает полосы частот
3. Пользователь настраивает значения
4. Система сохраняет изменения

Результат:
Параметры эквалайзера установлены.


A10. SIP — просмотр статуса

Предусловия:
- Пользователь находится во вкладке «Диагностика»

Основной сценарий:
1. Пользователь выбирает «SIP»
2. Система показывает статус регистрации и пояснение

Результат:
Пользователь понимает текущий статус SIP‑регистрации.


A11. Видео → Видеопоток

Предусловия:
- Пользователь находится во вкладке «Диагностика»
- Раздел «Видео» открыт

Основной сценарий:
1. Пользователь выбирает «Видеопоток»
2. Система показывает параметры основного и второго потока
3. Пользователь выбирает варианты в списках
4. Система сохраняет выбранные параметры

Результат:
Конфигурация видеопотоков обновлена.


A12. Сеть → DDNS

Предусловия:
- Пользователь находится во вкладке «Диагностика»
- Раздел «Сеть» открыт

Основной сценарий:
1. Пользователь выбирает «DDNS»
2. Система показывает переключатель "Включить DDNS"
3. Если переключатель выключен, все поля ввода скрыты, кнопка "Сохранить" неактивна
4. Пользователь включает переключатель
5. Система показывает все поля ввода для настройки DDNS
6. Пользователь заполняет данные:
   - Интервал отправки запросов (секунды)
   - Порт сервера
   - Адрес сервера
   - Логин
   - Пароль
   - Дополнительное поле (hostname)
7. Пользователь сохраняет изменения
8. Система применяет настройки

Результат:
DDNS настроен или выключен в соответствии с действиями пользователя. Поля ввода отображаются только когда DDNS включен.


A13. Сеть → Настройка сети

Предусловия:
- Пользователь находится во вкладке «Диагностика»
- Раздел «Сеть» открыт

Основной сценарий:
1. Пользователь выбирает «Настройка сети»
2. Система показывает режимы «Статический IP» и «DHCP» с соответствующими полями
3. Пользователь выбирает режим и заполняет/подтверждает параметры
4. Система применяет выбранные настройки

Расширения:
3а. Выбран «Статический IP»
- Пользователь вводит IP, маску, шлюз, DNS и сохраняет — параметры применены

3б. Выбран «DHCP»
- Пользователь подтверждает режим, при необходимости задаёт DNS — параметры назначаются автоматически

Результат:
Сетевые настройки применены согласно выбранному режиму.


A14. Сеть → Syslog

Предусловия:
- Пользователь находится во вкладке «Диагностика»
- Раздел «Сеть» открыт

Основной сценарий:
1. Пользователь выбирает «Syslog»
2. Система показывает переключатель и поля адреса/порта
3. Пользователь включает, вводит адрес и порт, сохраняет
4. Система включает отправку логов

Результат:
Отправка логов настроена или выключена по действию пользователя.


A15. Система → Обновление

Предусловия:
- Пользователь находится во вкладке «Диагностика»
- Раздел «Система» открыт
- Файл обновления доступен

Основной сценарий:
1. Пользователь выбирает «Обновление»
2. Система отображает текущую версию прошивки
3. Система предлагает выбрать метод обновления (HTTP или FTP)
4. Пользователь заполняет форму:
   - Путь до папки с файлами на сервере
   - Название файла (формат .isoam)
   - При выборе FTP: логин и пароль
5. Пользователь может открыть раздел "Расширенные настройки"
6. Система показывает расширенные опции:
   - Обновить микроконтроллер (переключатель)
   - Обновить приложения (переключатель)
   - Обновить аудиозаписи (онлайн-ассистент, оповещения) (переключатель)
   - Обновить библиотеки (переключатель)
7. Пользователь настраивает необходимые переключатели
8. Пользователь нажимает кнопку "Обновить устройство"
9. Система запрашивает подтверждение
10. После подтверждения система загружает, проверяет и уведомляет об успехе; при необходимости инициирует установку/перезагрузку

Расширения:
4а. Произошла ошибка загрузки/проверки
- Система сообщает о проблеме и предлагает повторить

5а. Пользователь не заполнил обязательные поля
- Система показывает ошибку и просит заполнить все обязательные поля

Результат:
Обновление установлено либо пользователь уведомлён о сбое. Расширенные настройки позволяют выбрать компоненты для обновления.


A16. Система → Дата и время

Предусловия:
- Пользователь находится во вкладке «Диагностика»
- Раздел «Система» открыт

Основной сценарий:
1. Пользователь выбирает «Дата и время»
2. Система показывает текущие значения и настройки синхронизации
3. Пользователь выбирает временную зону и/или сервер времени, включает синхронизацию
4. Система применяет и синхронизирует время

Результат:
Корректные дата/время и параметры синхронизации установлены.


A17. Система → Перезагрузка

Предусловия:
- Пользователь находится во вкладке «Диагностика»
- Раздел «Система» открыт

Основной сценарий:
1. Пользователь выбирает «Перезагрузка»
2. Система показывает кнопку перезагрузки
3. Пользователь подтверждает 2 последовательных диалога
4. Система инициирует перезагрузку

Расширения:
3а. Пользователь отменяет на любом шаге
- Перезагрузка не выполняется

Результат:
Устройство перезагружено или осталось без изменений при отмене.


A18. Система → Сброс устройства

Предусловия:
- Пользователь находится во вкладке «Диагностика»
- Раздел «Система» открыт

Основной сценарий:
1. Пользователь выбирает «Сброс устройства»
2. Система показывает опцию «Сбросить сетевые настройки» и кнопку сброса
3. Пользователь выбирает вариант и подтверждает 2 диалога
4. Система выполняет выбранный тип сброса

Расширения:
3а. Сброс без сетевых настроек
- Сбрасываются все параметры, кроме сетевых

3б. Полный сброс
- Сбрасываются все параметры, включая сетевые

Результат:
Устройство сброшено согласно выбранному варианту.


A19. Навигация по разделам «Диагностики»

Предусловия:
- Пользователь находится в задании с услугой "гуйдлайн домофон"
- Пользователь перешел на 4‑ю вкладку задания
- Вкладка "Диагностика" доступна

Основной сценарий:
1. Пользователь разворачивает/сворачивает разделы меню
2. Система показывает/скрывает пункты разделов
3. Переход по пункту открывает соответствующий экран
4. На всех экранах клавиатура автоматически открывается при фокусе на полях ввода
5. На всех экранах контент не обрезается снизу благодаря правильной настройке padding

Результат:
Пользователь быстро переходит к нужной функции. Интерфейс удобен и не имеет проблем с обрезанием контента.


A20. Поиск и пагинация списков

Предусловия:
- Пользователь находится на экране «Ключи» или «Квартиры»

Основной сценарий:
1. Пользователь вводит запрос в поле поиска
2. Система фильтрует список
3. При большом объёме данных пользователь переключает страницы
4. Система показывает элементы выбранной страницы

Результат:
Нужные элементы найдены, навигация по спискам удобна.

